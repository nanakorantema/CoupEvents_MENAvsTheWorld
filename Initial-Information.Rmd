---
title: "Initial Project Info"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(primer.data)
library(tidyverse)
library(ggplot2)
library(janitor)
library(rworldmap)

```

```{r intial data entryy} 
coup_data <- read_csv(file = "Coup_Data/Coup_Data_v2.0.0.csv")

spec_csv(file = "Coup_Data/Coup_Data_v2.0.0.csv")


  cols(
  coup_id = col_character(),
  cowcode = col_double(),
  country = col_character(),
  year = col_double(),
  month = col_character(),
  day = col_character(),
  event_type = col_character(),
  unrealized = col_double(),
  realized = col_double(),
  conspiracy = col_double(),
  attempt = col_double(),
  military = col_double(),
  dissident = col_double(),
  rebel = col_double(),
  palace = col_double(),
  foreign = col_double(),
  auto = col_double(),
  resign = col_double(),
  popular = col_double(),
  counter = col_double(),
  other = col_double(),
  noharm = col_double(),
  injured = col_double(),
  killed = col_double(),
  harrest = col_double(),
  jailed = col_double(),
  tried = col_double(),
  fled = col_double(),
  exile = col_double()
)

```

  ## Key Questions:
  
  Where are the most Coups? Where have they been most successful, least successful? Is there a type of coup that is particularly popular? Where? Are the countries that have popular revolts less likely to have coups in the future? (creating a predictive model?)
  
  Zooming in on the Middle East--> certain period especially unstable? Types of coups & how quickly they succeeded each other

```{r cleaning}

#unrealized = conspiracies and attempts
#realized = coup
#types of coups = Military, dissident, rebel, palace, Foreign-backed, Auto, popular revolt, forced resignations



Clean_coup <- coup_data %>% 
  select( - c(realized, unrealized, conspiracy, attempt, coup_id)) %>% 
  group_by(year) %>% 
  arrange(desc(year))

```


```{r creating_initial objects}
top_10_coups <- coup_data %>% 
  group_by(country) %>% 
  filter(event_type == "coup") %>% 
  select(country, event_type, realized) %>% 
  summarise(total_coup = sum(realized)) %>% 
  arrange(desc(total_coup)) %>% 
  slice(1:10) 

top_10_coups %>% 
  ggplot(aes(x = fct_reorder(country, total_coup),
             y = total_coup)) +
  labs(title = "Top 10 Countries with the Most Successful Coups from 1945- 2019",
       subtitle = "South and Central American countries have had the most successful coups",
       caption = "Source: Cline Center Coup D’état Project Dataset",
       x = "Country",
       y = "Number of Successful Coups") +
  coord_flip() +
  theme_minimal() +
  geom_col(fill = "darkolivegreen4")



urb_anim = tm_shape(world) + tm_polygons() + 
  tm_shape(urban_agglomerations) + tm_dots(size = "population_millions") +
  tm_facets(along = "year", free.coords = FALSE)
  
```

```{r realized_coup_mapping}

 realized_coup <- Clean_coup %>% 
                    group_by(country) %>% 
                    filter(event_type == "coup") %>% 
                    select(country, event_type, realized) %>% 
                    summarise(total_coup = sum(realized)) %>% 
                    arrange(desc(total_coup))

```


```{r manipulating_data}


attempted_coups <-coup_data %>% 
                    group_by(country) %>% 
                    filter(attempt == 1) %>% 
                    select(country, attempt) %>% 
                    summarise(failed_attempts = sum(attempt)) %>% 
                    arrange(desc(failed_attempts)) %>% 
                    slice(1:10) 

attempted_coups %>% 
  ggplot(aes(x = fct_reorder(country, failed_attempts),
             y = failed_attempts)) +
  labs(title = "Top 10 Countries with the Most Unsuccessful Coups from 1945- 2019",
       subtitle = "Coups fail all over the world",
       caption = "Source: Cline Center Coup D’état Project Dataset",
       x = "Country",
       y = "Number of Unsuccessful Coups") +
  coord_flip() +
  theme_minimal() +
  geom_col(fill = "darkolivegreen4")
```

```{r mapping_coup}

# maps for event types 
grouped_coup <- Clean_coup %>% 
  group_by(country, event_type) %>% 
  summarise(Coups = n()) %>% 
  filter(event_type == "coup")


joined_data <-joinCountryData2Map(grouped_coup,
                                 joinCode = "NAME",
                                 nameJoinColumn = "country")

thecoupMap <- mapCountryData( joined_data, nameColumnToPlot="Coups",
                              missingCountryCol='dark grey',
                              oceanCol="light blue",
                              addLegend=TRUE )


```
```{r mapping_attempts}

grouped_attempted <- Clean_coup %>% 
  group_by(country, event_type) %>% 
  summarise(Attempts = n()) %>% 
  filter(event_type == "attempted")


joined_data <-joinCountryData2Map(grouped_attempted,
                                 joinCode = "NAME",
                                 nameJoinColumn = "country")

theattemptedMap <- mapCountryData( joined_data, nameColumnToPlot="Attempts",
                                   missingCountryCol='dark grey',
                                    oceanCol="light blue",
                                    addLegend=TRUE )



```

```{r conspiracy map}

grouped_conspiracy <- Clean_coup %>% 
  group_by(country, event_type) %>% 
  summarise(Conspiracies = n()) %>% 
  filter(event_type == "conspiracy")


joined_data <-joinCountryData2Map(grouped_conspiracy,
                                 joinCode = "NAME",
                                 nameJoinColumn = "country")

theconspiracyMap <- mapCountryData( joined_data, 
                                    nameColumnToPlot="Conspiracies",
                                    missingCountryCol='dark grey',
                                    oceanCol="light blue",
                                    addLegend=TRUE )


```
```{r}
#creating an interactive statistical model  - parameters (location, prior coup history (successful/unsuccessful) or incorporate all of the info? (conspiracy, attempted, coup), coup typology )

#inputs= country, type of coup -> output unsuccessful, successful

#interactive map- discuss next week? 
```

